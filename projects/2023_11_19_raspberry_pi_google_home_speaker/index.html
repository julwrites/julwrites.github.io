<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="description" content="Julian Teh's personal website"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Fira+Sans:wght@400;500;700&display=swap" rel="stylesheet"><title>Turning a Bluetooth speaker into a Google Nest | tehj.io</title><link rel="stylesheet" href="/_astro/_slug_.e14127aa.css" />
<style>main[data-astro-cid-5uq7evlv]{max-width:800px;margin:0 auto;padding:0 1rem}article[data-astro-cid-5uq7evlv]{margin-bottom:4rem}h1[data-astro-cid-5uq7evlv]{font-size:2.5rem;margin-bottom:.5rem}.date[data-astro-cid-5uq7evlv]{margin-bottom:2rem;color:#666}.updated[data-astro-cid-5uq7evlv]{margin-top:.5rem;font-style:italic}.hero-image[data-astro-cid-5uq7evlv]{width:100%;height:auto;border-radius:8px;margin-bottom:2rem}.content[data-astro-cid-5uq7evlv]{line-height:1.6}.content[data-astro-cid-5uq7evlv] h2{margin-top:2rem;margin-bottom:1rem;font-size:1.8rem}.content[data-astro-cid-5uq7evlv] h3{margin-top:1.5rem;margin-bottom:.75rem;font-size:1.5rem}.content[data-astro-cid-5uq7evlv] p{margin-bottom:1rem}.content[data-astro-cid-5uq7evlv] img{max-width:100%;height:auto;border-radius:4px}.content[data-astro-cid-5uq7evlv] pre{padding:1rem;border-radius:4px;overflow-x:auto;margin:1rem 0}@media (prefers-color-scheme: dark){.date[data-astro-cid-5uq7evlv]{color:#aaa}}
</style></head> <body> <div class="container"> <header data-astro-cid-3ef6ksr2> <div class="header-content" data-astro-cid-3ef6ksr2> <h2 data-astro-cid-3ef6ksr2>Julian Teh</h2> <nav data-astro-cid-3ef6ksr2> <a href="/" class="" data-astro-cid-3ef6ksr2>Home</a> <a href="/projects" class="active" data-astro-cid-3ef6ksr2>Projects</a> <a href="/blog" class="" data-astro-cid-3ef6ksr2>Blog</a> <a href="https://github.com/julwrites" target="_blank" data-astro-cid-3ef6ksr2>GitHub</a> </nav> </div> </header>  <main>  <main data-astro-cid-5uq7evlv> <article data-astro-cid-5uq7evlv> <h1 data-astro-cid-5uq7evlv>Turning a Bluetooth speaker into a Google Nest</h1> <div class="date" data-astro-cid-5uq7evlv> <time datetime="2023-11-19T00:00:00.000Z" data-astro-cid-5uq7evlv> November 19, 2023 </time>  </div>  <div class="content" data-astro-cid-5uq7evlv> <p>I still had the Raspberry Pi Zero W from the last time I tried to <a href="https://tehj.io/blog/projects/2023_07_01_raspberry_pi_usb_camera/">make a USB Camera</a>. Since that didn’t work, I thought I’d try again with a different use case. We had recently done some upgrades to our smart home setup, and moved some of the speakers around, and we had one bluetooth speaker which was just sitting around now (Sonos really made their system so easy to use that it’s hard to go back to the ‘dumber’ speakers).</p>
<p>A bit of research and I found this <a href="https://www.instructables.com/DIY-Google-Home-With-Bluetooth-Speaker-on-Raspberr/">article</a>, which I thought I could use with just a few modifications since I didn’t have the docking hub they mentioned (and I wanted to use bluetooth for this speaker).</p>
<h2 id="problems-with-bluetooth-connection">Problems with Bluetooth Connection</h2>
<p>Immediately I ran into some issues following this approach. For some reason, using <code>bluetoothctl</code> and trying to connect to my bluetooth speaker wasn’t working. It was able to scan, pair, and trust the device, but connecting always resulted in a failure. Looking around on the internet, I went through a couple of possible solutions, but none of them seemed to work.</p>
<p>Eventually I came across a <a href="https://berthaamelia.github.io/blog/python/raspberrypi/2020/08/20/connect-bluetooth-speaker-to-raspi-zero.html">blog post</a> of someone who seemed to have done something rather similar to what I was trying. She (I think?) had documented this in a <a href="https://gist.github.com/actuino/9548329d1bba6663a63886067af5e4cb">Github Gist</a>, which had instructions on how to replicate this.</p>
<p>After going through the steps listed, the connection worked! I additionally went through the comments and also installed a couple more packages, and enabled the <code>a2dp</code> plugin for the bluetooth service.</p>
<h3 id="steps">Steps:</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span>sudo apt-get update </span></span>
<span class="line"><span>sudo apt-get dist-upgrade</span></span>
<span class="line"><span>sudo reboot</span></span>
<span class="line"><span></span></span>
<span class="line"><span>sudo apt-get install pulseaudio pulseaudio-module-bluetooth bluez-tools</span></span>
<span class="line"><span>pulseaudio --start</span></span></code></pre>
<p>I created a file to override the bluetooth service configuration at <code>/etc/systemd/system/bluetooth.service.d/01-disable-sap-plugin.conf</code></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span>[Service]</span></span>
<span class="line"><span>ExecStart=</span></span>
<span class="line"><span>ExecStart=/usr/lib/bluetooth/bluetoothd --plugin=a2dp</span></span></code></pre>
<p>Followed by</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span>sudo systemctl daemon-reload</span></span>
<span class="line"><span>sudo systemctl restart bluetooth.service</span></span>
<span class="line"><span></span></span>
<span class="line"><span>sudo bluetoothctl</span></span></code></pre>
<p>The <code>bluetoothctl</code> commands are fairly straightforward if they work:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span>power on</span></span>
<span class="line"><span>agent on</span></span>
<span class="line"><span>default-agent</span></span>
<span class="line"><span>scan on</span></span>
<span class="line"><span>pair &#x3C;MAC Address></span></span>
<span class="line"><span>trust &#x3C;MAC Address></span></span>
<span class="line"><span>connect &#x3C;MAC Address></span></span>
<span class="line"><span>quit</span></span></code></pre>
<p>Then I tested it with a little sound file.</p>
<p>After this I went back to the original article and set up my <code>.asoundrc</code> file to enable the mic.</p>
<h2 id="setting-up-google-assistant">Setting up Google Assistant</h2>
<p>The first thing I noticed was that the Google Assistant Library was deprecated, but the Google Assistant Service SDK was viable, and there were instructions for <a href="https://developers.google.com/assistant/sdk/guides/service/python/embed/setup">Raspberry Pi</a>.</p>
<p>I was able to access the actions SDK, and register my device model according to the article, and then I went back and started on setting up the python service for Google Assistant to run.</p>
<p>The setup instructions were fairly straightforward, but with a couple of things that needed tweaking. I had to install <code>grpcio</code> manually, because pip kept trying to build the latest supported version, and installing any of the others ran into a checksum issue.</p>
<p>And then I realized that <code>google-oauth-tool</code> required Python 3.9 because of a dependency that was <a href="https://stackoverflow.com/questions/69381312/importerror-cannot-import-name-mapping-from-collections-using-python-3-10/70557518#70557518">affected</a> in Python 3.10.</p>
<p>After some experimenting, it turned out I couldn’t just install Python 3.9 on RasbianOS Bookworm, so I had to go and re-flash my Raspberry Pi with RaspbianOS (legacy).</p>
<p>But once I had Python3.9 installed, I was able to run the commands quite straightforwardly, and then re-do my bluetooth setup.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span>sudo apt-get update</span></span>
<span class="line"><span>sudo apt-get install python3-dev python3-venv</span></span>
<span class="line"><span>python3 -m venv env</span></span>
<span class="line"><span>env/bin/python -m pip install --upgrade pip setuptools wheel</span></span>
<span class="line"><span>source env/bin/activate</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>sudo apt-get install portaudio19-dev libffi-dev libssl-dev</span></span>
<span class="line"><span>pip install --upgrade google-assistant-sdk[samples] google-auth-oauthlib[tool]</span></span></code></pre>
<h2 id="google-assistant-sdk-sunset">Google Assistant SDK Sunset</h2>
<p>And then here is where the whole project just got blocked. Turns out, the Google Assistant SDK has been <a href="https://developers.google.com/assistant/ca-sunset">sunset</a>, and so… There died also my dreams of plugging a Raspberry Pi Zero into a speaker and having an extra Google Nest.</p>
<p>Not all is lost, being able to connect the Rasberry Pi Zero to a bluetooth speaker is one sort of win, and perhaps it is useful to still play audio through it, but it doesn’t meet the need I have at the moment.</p>
<p>So… On to the next Raspberry Pi Zero project!</p> </div> </article> </main>  </main> <footer data-astro-cid-sz7xmlte> <div class="links-container" data-astro-cid-sz7xmlte> <div class="links-section" data-astro-cid-sz7xmlte> <p data-astro-cid-sz7xmlte>Connect With Me</p> <div class="icons" data-astro-cid-sz7xmlte> <a href="https://github.com/julwrites/julwrites.github.io/raw/master/assets/resume/Resume_Julian_Teh.pdf" target="_blank" title="Resume" data-astro-cid-sz7xmlte> <img src="/assets/images/dark/resume.png" alt="Resume" data-astro-cid-sz7xmlte> <span data-astro-cid-sz7xmlte>Resume</span> </a> <a href="https://linkedin.com/in/julwrites" target="_blank" title="LinkedIn" data-astro-cid-sz7xmlte> <img src="/assets/images/dark/linkedin.png" alt="LinkedIn" data-astro-cid-sz7xmlte> <span data-astro-cid-sz7xmlte>LinkedIn</span> </a> <a href="mailto:contact@tehj.io" target="_blank" title="Email" data-astro-cid-sz7xmlte> <img src="/assets/images/dark/email.png" alt="Email" data-astro-cid-sz7xmlte> <span data-astro-cid-sz7xmlte>Email</span> </a> </div> </div> </div> <p data-astro-cid-sz7xmlte>&copy; 2025 Julian Teh. All rights reserved.</p> </footer>  </div> </body></html> 