<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="description" content="Julian Teh's personal website"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Fira+Sans:wght@400;500;700&display=swap" rel="stylesheet"><title>Setting up Nginx Reverse Proxy to Custom Domain | tehj.io</title><link rel="stylesheet" href="/_astro/_slug_.e14127aa.css" />
<style>main[data-astro-cid-5uq7evlv]{max-width:800px;margin:0 auto;padding:0 1rem}article[data-astro-cid-5uq7evlv]{margin-bottom:4rem}h1[data-astro-cid-5uq7evlv]{font-size:2.5rem;margin-bottom:.5rem}.date[data-astro-cid-5uq7evlv]{margin-bottom:2rem;color:#666}.updated[data-astro-cid-5uq7evlv]{margin-top:.5rem;font-style:italic}.hero-image[data-astro-cid-5uq7evlv]{width:100%;height:auto;border-radius:8px;margin-bottom:2rem}.content[data-astro-cid-5uq7evlv]{line-height:1.6}.content[data-astro-cid-5uq7evlv] h2{margin-top:2rem;margin-bottom:1rem;font-size:1.8rem}.content[data-astro-cid-5uq7evlv] h3{margin-top:1.5rem;margin-bottom:.75rem;font-size:1.5rem}.content[data-astro-cid-5uq7evlv] p{margin-bottom:1rem}.content[data-astro-cid-5uq7evlv] img{max-width:100%;height:auto;border-radius:4px}.content[data-astro-cid-5uq7evlv] pre{padding:1rem;border-radius:4px;overflow-x:auto;margin:1rem 0}@media (prefers-color-scheme: dark){.date[data-astro-cid-5uq7evlv]{color:#aaa}}
</style></head> <body> <div class="container"> <header data-astro-cid-3ef6ksr2> <div class="header-content" data-astro-cid-3ef6ksr2> <h2 data-astro-cid-3ef6ksr2>Julian Teh</h2> <nav data-astro-cid-3ef6ksr2> <a href="/" class="" data-astro-cid-3ef6ksr2>Home</a> <a href="/projects" class="active" data-astro-cid-3ef6ksr2>Projects</a> <a href="/blog" class="" data-astro-cid-3ef6ksr2>Blog</a> <a href="https://github.com/julwrites" target="_blank" data-astro-cid-3ef6ksr2>GitHub</a> </nav> </div> </header>  <main>  <main data-astro-cid-5uq7evlv> <article data-astro-cid-5uq7evlv> <h1 data-astro-cid-5uq7evlv>Setting up Nginx Reverse Proxy to Custom Domain</h1> <div class="date" data-astro-cid-5uq7evlv> <time datetime="2022-08-16T00:00:00.000Z" data-astro-cid-5uq7evlv> August 16, 2022 </time>  </div> <img src="/blog/assets/blog/2020_08_16_Nginx_Server/CodeServer.png" alt="Hero image for Setting up Nginx Reverse Proxy to Custom Domain" class="hero-image" data-astro-cid-5uq7evlv> <div class="content" data-astro-cid-5uq7evlv> <p>Next I wanted to be able to access this from my custom domain, and therefore have a browser-based IDE available for myself anywhere with internet access.</p>
<p>This took a little more work; I had to install <code>nginx</code> to serve as a reverse proxy, and <code>certbot-nginx</code> for SSL encryption.</p>
<p>A couple of commands later…</p>
<ul>
<li><code>dnf install -y nginx certbot-nginx</code></li>
<li><code>systemctl enable nginx --now</code></li>
</ul>
<p>Some configuration needed to be done for <code>nginx</code> to do proxy passing to my existing servers. I had previously set up NextCloud on a Raspberry Pi, so that had to be modified to allow the new server with <code>nginx</code> to handle the reverse proxy for all devices behind the IP address.</p>
<p>I set up the <code>nginx.conf</code> to listen on Port 443, and did some <a href="https://www.digitalocean.com/community/tutorials/how-to-secure-nginx-with-let-s-encrypt-on-centos-7">configuration</a> to perform a <code>proxy_pass</code> to the other servers involved. This proved tricky when it came to SSL certification; LetsEncrypt required that the custom domain being specified for SSL certification be accessible and responsive, which led to a number of retries and that in turn led to a number of failed attempts, which… Had some <a href="https://letsencrypt.org/docs/rate-limits/">rate limits</a> that made it quite a pain to get working.</p>
<p>I then added an A record to my subdomain, and pointed it to my public IP address, added port forwarding on my router to my device for <code>http</code> and <code>https</code> access, and… Poof, went my Cockpit access. I had managed to cause Cockpit’s SSL cert to be replaced. This was, fortunately, easily resolved by SSH-ing into the client and re-running <code>certbot</code> to <a href="https://certbot.eff.org/lets-encrypt/fedora-nginx">replace the certificate</a>.</p>
<p>Some debugging on whether <code>nginx</code> was actually listening to Port 443 told me that it was.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span># netstat -anop | grep LISTEN | grep nginx</span></span>
<span class="line"><span>tcp        0      0 0.0.0.0:443             0.0.0.0:*               LISTEN      1049/nginx: master   off (0.00/0/0)</span></span></code></pre>
<p>I made sure <code>certbot</code> was <a href="https://certbot.eff.org/lets-encrypt/fedora-nginx">registering my certificates and keys</a> properly before proceeding, but this still didn’t get me access through my custom domain. This did allow me though, to get past the rate limits since I now had valid certificates that did not need to be renewed, simply used. This was done by setting up my <code>nginx.conf</code> such that each server had it’s own SSL configuration.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span>server {</span></span>
<span class="line"><span>    listen       443 ssl;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    server_name  &#x3C;custom domain>;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    ssl_certificate         /etc/letsencrypt/live/&#x3C;custom domain>/cert.pem;</span></span>
<span class="line"><span>    ssl_certificate_key     /etc/letsencrypt/live/&#x3C;custom domain>/privkey.pem;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    access_log              /var/log/nginx/&#x3C;custom domain>.access.log;</span></span>
<span class="line"><span>    error_log               /var/log/nginx/&#x3C;custom domain>.error.log;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    location / {</span></span>
<span class="line"><span>        proxy_pass                http://localhost:8080;</span></span>
<span class="line"><span>        proxy_redirect            http://localhost:8080 https://&#x3C;custom domain>;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre>
<p>Next I had to make sure the firewall wasn’t blocking my ports. This was fairly easy to do with Cockpit, and I was able to quickly check that the service was enabling Port access for 443.</p>
<p><img src="/blog/assets/blog/2020_08_16_Nginx_Server/CockpitFirewall.png" alt="CockpitFirewall.png"></p>
<p>Another thing to check was that SELinux wasn’t blocking something that docker needed to access the network, so after some <a href="https://stackoverflow.com/questions/23948527/13-permission-denied-while-connecting-to-upstreamnginx">searching</a>…</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span>setsebool httpd_can_network_connect on -P</span></span></code></pre>
<p>Finally I found that <code>nginx</code> was running as root, but that <code>nginx.conf</code> had set the user field to <code>nginx</code> instead of <code>root</code>. Once this was toggled, access to my code server was enabled, and I could see the login page.</p>
<p><img src="/blog/assets/blog/2020_08_16_Nginx_Server/CodeTehjIo.png" alt="CodeTehjIo.png"></p>
<p>This had one last issue, which was that while the login page displayed, and I could log in, code-server didn’t load. Opening the console window showed a whole bunch of <code>websocket</code> errors, and upon some research, I found that this was because <code>nginx</code> needed to pass more <a href="https://github.com/websockets/ws/issues/979#issuecomment-337934638">proxy header information</a> to docker than it was already doing (it was receiving a success code back that it didn’t know how to handle)</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span>location / {</span></span>
<span class="line"><span>    proxy_pass         http://localhost:8080;</span></span>
<span class="line"><span>    proxy_http_version 1.1;</span></span>
<span class="line"><span>    proxy_set_header   Upgrade $http_upgrade;</span></span>
<span class="line"><span>    proxy_set_header   Connection "upgrade";</span></span>
<span class="line"><span>    proxy_set_header   Host $host;</span></span>
<span class="line"><span>}</span></span></code></pre>
<p>Once this was done, everything worked, and code-server was accessible from the browser through my custom domain.</p>
<p><img src="/blog/assets/blog/2020_08_16_Nginx_Server/CodeServer.png" alt="CodeServer.png"></p> </div> </article> </main>  </main> <footer data-astro-cid-sz7xmlte> <div class="links-container" data-astro-cid-sz7xmlte> <div class="links-section" data-astro-cid-sz7xmlte> <p data-astro-cid-sz7xmlte>Connect With Me</p> <div class="icons" data-astro-cid-sz7xmlte> <a href="https://github.com/julwrites/julwrites.github.io/raw/master/assets/resume/Resume_Julian_Teh.pdf" target="_blank" title="Resume" data-astro-cid-sz7xmlte> <img src="/assets/images/dark/resume.png" alt="Resume" data-astro-cid-sz7xmlte> <span data-astro-cid-sz7xmlte>Resume</span> </a> <a href="https://linkedin.com/in/julwrites" target="_blank" title="LinkedIn" data-astro-cid-sz7xmlte> <img src="/assets/images/dark/linkedin.png" alt="LinkedIn" data-astro-cid-sz7xmlte> <span data-astro-cid-sz7xmlte>LinkedIn</span> </a> <a href="mailto:contact@tehj.io" target="_blank" title="Email" data-astro-cid-sz7xmlte> <img src="/assets/images/dark/email.png" alt="Email" data-astro-cid-sz7xmlte> <span data-astro-cid-sz7xmlte>Email</span> </a> </div> </div> </div> <p data-astro-cid-sz7xmlte>&copy; 2025 Julian Teh. All rights reserved.</p> </footer>  </div> </body></html> 