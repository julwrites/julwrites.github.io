{"version":3,"sources":["webpack:///./src/content/blog/2020_08_16_Nginx_Server/CockpitFirewall.png","webpack:///./src/content/blog/2020_08_16_Nginx_Server/2020_08_16_Nginx_Server.md?d69f","webpack:///./src/content/blog/2020_08_16_Nginx_Server/2020_08_16_Nginx_Server.md","webpack:///./src/content/blog/2020_08_16_Nginx_Server/CodeServer.png","webpack:///./src/content/blog/2020_08_16_Nginx_Server/CodeTehjIo.png"],"names":["module","exports","render","_vm","this","_h","$createElement","_self","_c","_m","staticRenderFns","_v","pre","attrs","script","component"],"mappings":"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","file":"js/chunk-09a6e584.579b4060.js","sourcesContent":["module.exports = __webpack_public_path__ + \"img/CockpitFirewall.e50305a4.png\";","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _vm._m(0)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('section',[_c('h1',[_vm._v(\"Setting up Nginx Reverse Proxy to Custom Domain\")]),_c('p',[_vm._v(\"Next I wanted to be able to access this from my custom domain, and therefore have a browser-based IDE available for myself anywhere with internet access.\")]),_c('p',[_vm._v(\"This took a little more work; I had to install \"),_c('code',{pre:true},[_vm._v(\"nginx\")]),_vm._v(\" to serve as a reverse proxy, and \"),_c('code',{pre:true},[_vm._v(\"certbot-nginx\")]),_vm._v(\" for SSL encryption.\")]),_c('p',[_vm._v(\"A couple of commands later...\")]),_c('ul',[_c('li',[_c('code',{pre:true},[_vm._v(\"dnf install -y nginx certbot-nginx\")])]),_c('li',[_c('code',{pre:true},[_vm._v(\"systemctl enable nginx --now\")])])]),_c('p',[_vm._v(\"Some configuration needed to be done for \"),_c('code',{pre:true},[_vm._v(\"nginx\")]),_vm._v(\" to do proxy passing to my existing servers. I had previously set up NextCloud on a Raspberry Pi, so that had to be modified to allow the new server with \"),_c('code',{pre:true},[_vm._v(\"nginx\")]),_vm._v(\" to handle the reverse proxy for all devices behind the IP address.\")]),_c('p',[_vm._v(\"I set up the \"),_c('code',{pre:true},[_vm._v(\"nginx.conf\")]),_vm._v(\" to listen on Port 443, and did some \"),_c('a',{attrs:{\"href\":\"https://www.digitalocean.com/community/tutorials/how-to-secure-nginx-with-let-s-encrypt-on-centos-7\"}},[_vm._v(\"configuration\")]),_vm._v(\" to perform a \"),_c('code',{pre:true},[_vm._v(\"proxy_pass\")]),_vm._v(\" to the other servers involved. This proved tricky when it came to SSL certification; LetsEncrypt required that the custom domain being specified for SSL certification be accessible and responsive, which led to a number of retries and that in turn led to a number of failed attempts, which... Had some \"),_c('a',{attrs:{\"href\":\"https://letsencrypt.org/docs/rate-limits/\"}},[_vm._v(\"rate limits\")]),_vm._v(\" that made it quite a pain to get working.\")]),_c('p',[_vm._v(\"I then added an A record to my subdomain, and pointed it to my public IP address, added port forwarding on my router to my device for \"),_c('code',{pre:true},[_vm._v(\"http\")]),_vm._v(\" and \"),_c('code',{pre:true},[_vm._v(\"https\")]),_vm._v(\" access, and... Poof, went my Cockpit access. I had managed to cause Cockpit's SSL cert to be replaced. This was, fortunately, easily resolved by SSH-ing into the client and re-running \"),_c('code',{pre:true},[_vm._v(\"certbot\")]),_vm._v(\" to \"),_c('a',{attrs:{\"href\":\"https://certbot.eff.org/lets-encrypt/fedora-nginx\"}},[_vm._v(\"replace the certificate\")]),_vm._v(\".\")]),_c('p',[_vm._v(\"Some debugging on whether \"),_c('code',{pre:true},[_vm._v(\"nginx\")]),_vm._v(\" was actually listening to Port 443 told me that it was.\")]),_c('pre',{pre:true},[_c('code',{pre:true,attrs:{\"v-pre\":\"\"}},[_vm._v(\"# netstat -anop | grep LISTEN | grep nginx\\ntcp        0      0 0.0.0.0:443             0.0.0.0:*               LISTEN      1049/nginx: master   off (0.00/0/0)\\n\")])]),_c('p',[_vm._v(\"I made sure \"),_c('code',{pre:true},[_vm._v(\"certbot\")]),_vm._v(\" was \"),_c('a',{attrs:{\"href\":\"https://certbot.eff.org/lets-encrypt/fedora-nginx\"}},[_vm._v(\"registering my certificates and keys\")]),_vm._v(\" properly before proceeding, but this still didn't get me access through my custom domain. This did allow me though, to get past the rate limits since I now had valid certificates that did not need to be renewed, simply used. This was done by setting up my \"),_c('code',{pre:true},[_vm._v(\"nginx.conf\")]),_vm._v(\" such that each server had it's own SSL configuration.\")]),_c('pre',{pre:true},[_c('code',{pre:true,attrs:{\"v-pre\":\"\"}},[_vm._v(\"server {\\n    listen       443 ssl;\\n\\n    server_name  <custom domain>;\\n\\n    ssl_certificate         /etc/letsencrypt/live/<custom domain>/cert.pem;\\n    ssl_certificate_key     /etc/letsencrypt/live/<custom domain>/privkey.pem;\\n\\n    access_log              /var/log/nginx/<custom domain>.access.log;\\n    error_log               /var/log/nginx/<custom domain>.error.log;\\n\\n    location / {\\n        proxy_pass                http://localhost:8080;\\n        proxy_redirect            http://localhost:8080 https://<custom domain>;\\n    }\\n}\\n\")])]),_c('p',[_vm._v(\"Next I had to make sure the firewall wasn't blocking my ports. This was fairly easy to do with Cockpit, and I was able to quickly check that the service was enabling Port access for 443.\")]),_c('p',[_c('img',{attrs:{\"src\":require(\"./CockpitFirewall.png\"),\"alt\":\"CockpitFirewall.png\"}})]),_c('p',[_vm._v(\"Another thing to check was that SELinux wasn't blocking something that docker needed to access the network, so after some \"),_c('a',{attrs:{\"href\":\"https://stackoverflow.com/questions/23948527/13-permission-denied-while-connecting-to-upstreamnginx\"}},[_vm._v(\"searching\")]),_vm._v(\"...\")]),_c('pre',{pre:true},[_c('code',{pre:true,attrs:{\"v-pre\":\"\"}},[_vm._v(\"setsebool httpd_can_network_connect on -P\\n\")])]),_c('p',[_vm._v(\"Finally I found that \"),_c('code',{pre:true},[_vm._v(\"nginx\")]),_vm._v(\" was running as root, but that \"),_c('code',{pre:true},[_vm._v(\"nginx.conf\")]),_vm._v(\" had set the user field to \"),_c('code',{pre:true},[_vm._v(\"nginx\")]),_vm._v(\" instead of \"),_c('code',{pre:true},[_vm._v(\"root\")]),_vm._v(\". Once this was toggled, access to my code server was enabled, and I could see the login page.\")]),_c('p',[_c('img',{attrs:{\"src\":require(\"./CodeTehjIo.png\"),\"alt\":\"CodeTehjIo.png\"}})]),_c('p',[_vm._v(\"This had one last issue, which was that while the login page displayed, and I could log in, code-server didn't load. Opening the console window showed a whole bunch of \"),_c('code',{pre:true},[_vm._v(\"websocket\")]),_vm._v(\" errors, and upon some research, I found that this was because \"),_c('code',{pre:true},[_vm._v(\"nginx\")]),_vm._v(\" needed to pass more \"),_c('a',{attrs:{\"href\":\"https://github.com/websockets/ws/issues/979#issuecomment-337934638\"}},[_vm._v(\"proxy header information\")]),_vm._v(\" to docker than it was already doing (it was receiving a success code back that it didn't know how to handle)\")]),_c('pre',{pre:true},[_c('code',{pre:true,attrs:{\"v-pre\":\"\"}},[_vm._v(\"location / {\\n    proxy_pass                 http://localhost:8080;\\n    proxy_http_version 1.1;\\n    proxy_set_header   Upgrade $http_upgrade;\\n    proxy_set_header   Connection \\\"upgrade\\\";\\n    proxy_set_header   Host $host;\\n}\\n\")])]),_c('p',[_vm._v(\"Once this was done, everything worked, and code-server was accessible from the browser through my custom domain.\")]),_c('p',[_c('img',{attrs:{\"src\":require(\"./CodeServer.png\"),\"alt\":\"CodeServer.png\"}})])])}]\n\nexport { render, staticRenderFns }","import { render, staticRenderFns } from \"./2020_08_16_Nginx_Server.md?vue&type=template&id=6a033cdf&\"\nvar script = {}\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","module.exports = __webpack_public_path__ + \"img/CodeServer.694bfcd5.png\";","module.exports = __webpack_public_path__ + \"img/CodeTehjIo.c609b702.png\";"],"sourceRoot":""}